<app-header></app-header>

<!-- Search Box Section -->
<div class="main-search-container-analyze">
  <div class="search-input-group-analyze" [class.loading]="isLoading">
    <select [(ngModel)]="currentSearchType" (change)="onTypeChange()" class="input-type-select-analyze">
      <option [ngValue]="1">üì± S·ªë ƒëi·ªán tho·∫°i</option>
      <option [ngValue]="2">üè¶ S·ªë t√†i kho·∫£n</option>
      <option [ngValue]="3">üåê URL</option>
    </select>
    <input type="text" class="search-input-analyze" 
           placeholder="Nh·∫≠p th√¥ng tin c·∫ßn ki·ªÉm tra..." 
           [(ngModel)]="currentSearchInfo" 
           (keydown.enter)="analyzeNewInput()">
    <button class="search-button-analyze" (click)="analyzeNewInput()" [disabled]="!currentSearchInfo.trim() || isLoading">
      <i [class]="getSearchInputTypeIcon()"></i>
    </button>
  </div>
  
  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message-analyze">
    {{ errorMessage }}
  </div>
</div>

<!-- MAIN CONTENT -->
<main class="analyze-container" *ngIf="hasValidAnalysisData()">
  <div class="analyze-header">
    <h2><i [class]="getInputTypeIcon()"></i> {{ inputInfo }}</h2>
    <div class="status-box" [ngClass]="getRiskColor()" *ngIf="getSafetyStatus() !== 'ƒêang ph√¢n t√≠ch...'">
      <p class="status-text">{{ getSafetyStatus() }}</p>
    </div>
  </div>

  <div class="analysis-content">
    <!-- C·ªôt Tr√°i: B√°o c√°o t·ª´ c√°c ngu·ªìn -->
    <div class="analysis-column left-column">
      <div class="section external-reports">
        <h3><i class="fas fa-file-alt"></i> B√°o c√°o t·ª´ c√°c ngu·ªìn</h3>
        <div class="reports-grid">
          <div class="report-item">
            <div class="report-header">
              <i class="fas fa-shield-alt"></i>
              <span class="report-name">ChongLuaDao</span>
            </div>
            <div class="report-status not-found">kh√¥ng t√¨m th·∫•y</div>
          </div>
          
          <div class="report-item">
            <div class="report-header">
              <i class="fas fa-chart-line"></i>
              <span class="report-name">ScamAdviser</span>
            </div>
            <div class="report-status" [ngClass]="getScamAdviserClass(analysisResult?.trustScore)">
              {{ analysisResult?.trustScore || 'N/A' }}/100
            </div>
          </div>
          
          <div class="report-item">
            <div class="report-header">
              <i class="fas fa-database"></i>
              <span class="report-name">Hudson Rock</span>
            </div>
            <div class="report-status" [ngClass]="analysisResult?.dataBreach !== 'kh√¥ng t√¨m th·∫•y' ? 'warning' : 'safe'">
              {{ analysisResult?.dataBreach || 'kh√¥ng t√¨m th·∫•y' }}
            </div>
          </div>
          
          <div class="report-item">
            <div class="report-header">
              <i class="fab fa-google"></i>
              <span class="report-name">Google Web Risk</span>
            </div>
            <div class="report-status" [ngClass]="analysisResult?.phishingList !== 'kh√¥ng t√¨m th·∫•y' ? 'danger' : 'safe'">
              {{ analysisResult?.phishingList || 'kh√¥ng t√¨m th·∫•y' }}
            </div>
          </div>
          
          <div class="report-item">
            <div class="report-header">
              <i class="fas fa-globe"></i>
              <span class="report-name">APWG</span>
            </div>
            <div class="report-status" [ngClass]="analysisResult?.apwgCategory !== 'kh√¥ng t√¨m th·∫•y' ? 'warning' : 'safe'">
              {{ analysisResult?.apwgCategory || 'kh√¥ng t√¨m th·∫•y' }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- C·ªôt Gi·ªØa: T·∫•t c·∫£ ph√¢n t√≠ch AI -->
    <div class="analysis-column center-column">
      <!-- Ph√¢n t√≠ch AI -->
      <div class="section ai-analysis-summary">
        <h3><i class="fas fa-robot"></i> Ph√¢n t√≠ch AI</h3>
        <div class="summary-content">
          <div class="summary-item risk-level">
            <h4><i class="fas fa-exclamation-triangle"></i> M·ª©c ƒë·ªô r·ªßi ro</h4>
            <div class="risk-indicator" [ngClass]="getRiskColor()">
              <span class="risk-text">{{ getSafetyStatus() }}</span>
              <div class="risk-description" [innerHTML]="formatText(riskLevelDescription)"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ph√°t hi·ªán chi ti·∫øt -->
      <div class="section discovery-details">
        <h3><i class="fas fa-search"></i> Ph√°t hi·ªán chi ti·∫øt</h3>
        <div class="description-content" [innerHTML]="formatText(detailedAnalysis)"></div>
      </div>

      <!-- Khuy·∫øn ngh·ªã an to√†n -->
      <div class="section recommendations-details">
        <h3><i class="fas fa-lightbulb"></i> Khuy·∫øn ngh·ªã an to√†n</h3>
        <div class="description-content" [innerHTML]="formatText(recommendations)"></div>
      </div>
    </div>

    <!-- C·ªôt Ph·∫£i: Ghi h√¨nh tr·ª±c ti·∫øp - Thu nh·ªè khung -->
    <div class="analysis-column right-column">
      <div class="section screenshot-capture compact">
        <h3><i class="fas fa-camera"></i> Ghi h√¨nh tr·ª±c ti·∫øp <span class="evidence-count">({{ getEvidenceImages().length }})</span></h3>
        <div class="screenshot-gallery" *ngIf="getEvidenceImages().length > 0; else noImages">
          <!-- Ti√™u ƒë·ªÅ cho khung ·∫£nh -->
          <div class="gallery-header">
            <h4><i class="fas fa-images"></i> B·∫±ng ch·ª©ng h√¨nh ·∫£nh</h4>
            <span class="image-count">{{ getEvidenceImages().length }} ·∫£nh</span>
          </div>
          
          <!-- Container c√°c ·∫£nh -->
          <div class="images-container">
            <!-- Hi·ªÉn th·ªã t·ªëi ƒëa 4 ·∫£nh ƒë·∫ßu -->
            <div class="screenshot-item" *ngFor="let imageUrl of getDisplayedImages(); let i = index">
              <div class="image-container loading">
                <img [src]="getFullImageUrl(imageUrl)" 
                     [alt]="'B·∫±ng ch·ª©ng ' + (i + 1)" 
                     class="screenshot-img"
                     (error)="onImageError($event)"
                     (load)="onImageLoad($event)"
                     (click)="onImageClick(imageUrl)"
                     loading="lazy"
                     style="cursor: pointer;">
                <div class="loading-spinner" *ngIf="!imageLoaded">
                  <i class="fas fa-spinner fa-spin"></i>
                </div>
              </div>
            </div>
            
            <!-- N√∫t "+X ·∫£nh" n·∫øu c√≥ nhi·ªÅu h∆°n 4 ·∫£nh -->
            <div class="screenshot-item more-images" *ngIf="getRemainingImagesCount() > 0" (click)="showAllImages()">
              <div class="more-images-overlay">
                <div class="more-count">+{{ getRemainingImagesCount() }}</div>
                <div class="more-text">·∫£nh kh√°c</div>
              </div>
            </div>
          </div>
        </div>
        <ng-template #noImages>
          <div class="screenshot-placeholder compact">
            <i class="fas fa-exclamation-triangle fa-2x" style="color: #ffa500;"></i>
            <p>Kh√¥ng th·ªÉ ghi h√¨nh website</p>
            <small>Website kh√¥ng th·ªÉ truy c·∫≠p ho·∫∑c kh√¥ng t·ªìn t·∫°i</small>
          </div>
        </ng-template>
        <button class="btn-primary compact">T·∫†O V√Ä T√ôY CH·ªàNH LI√äN K·∫æT</button>
      </div>
    </div>
  </div>
</main>

<!-- Placeholder khi ch∆∞a c√≥ k·∫øt qu·∫£ -->
<div class="no-result-placeholder" *ngIf="!hasValidAnalysisData()">
  <div class="placeholder-content">
    <i class="fas fa-search fa-3x"></i>
    <h3>Nh·∫≠p th√¥ng tin ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch</h3>
    <p>S·ª≠ d·ª•ng thanh t√¨m ki·∫øm ·ªü tr√™n ƒë·ªÉ ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i, URL ho·∫∑c s·ªë t√†i kho·∫£n</p>
  </div>
</div>

<app-footer></app-footer>
