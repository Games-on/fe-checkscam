<app-header (aiTuVanClicked)="onAiTuVanClicked()"></app-header>

<div class="report-page-container">
  <div class="two-column-layout">

    <div class="left-column">
      <form class="report-form" #reportForm="ngForm" (ngSubmit)="createReport()" novalidate>
        <h3 class="info-box-title">BÁO CÁO LỪA ĐẢO</h3>

        <div class="form-group report-type-selection">
          <label>Chọn loại báo cáo:</label>
          <div class="radio-group">
            <input type="radio" id="singleReport" name="reportType" [value]="'single'" [(ngModel)]="reportType" required>
            <label for="singleReport">Báo cáo đơn</label>

            <input type="radio" id="groupReport" name="reportType" [value]="'group'" [(ngModel)]="reportType" required>
            <label for="groupReport">Báo cáo gộp</label>
          </div>
        </div>

        <div class="form-group">
          <label for="categoryId">Danh mục báo cáo:</label>
          <select id="categoryId" name="categoryId" [(ngModel)]="selectedCategoryId" required class="form-control">
            <option [ngValue]="null" disabled selected>-- Chọn danh mục --</option>
            <option [ngValue]="1">Đầu tư</option>
            <option [ngValue]="2">Bán hàng Online</option>
            <option [ngValue]="3">Đồ thể thao</option>
            <option [ngValue]="4">Giao dịch trung gian</option>
            <option [ngValue]="5">Kiếm tiền online</option>
            <option [ngValue]="6">Lừa đảo, cờ bạc</option>
            <option [ngValue]="7">Marketing Online</option>
            <option [ngValue]="8">Nick game</option>
            <option [ngValue]="9">Nội dung số</option>
            <option [ngValue]="10">Phần mềm</option>
            <option [ngValue]="11">Sim số đẹp</option>
            <option [ngValue]="12">Tài khoản MXH</option>
            <option [ngValue]="13">Thẻ cào, game</option>
            <option [ngValue]="14">Tiền ảo</option>
            <option [ngValue]="15">Dịch vụ khác</option>
          </select>
          <div *ngIf="reportForm.controls['categoryId']?.invalid && reportForm.controls['categoryId']?.touched" class="text-danger">
            Vui lòng chọn danh mục báo cáo.
          </div>
        </div>

        <ng-container *ngIf="reportType === 'single'">
          <div class="form-group">
            <label for="single_type">Tố cáo về:</label>
            <select id="single_type" name="single_type" required [(ngModel)]="singleReportItem.type" (change)="resetSingleInfoFields()">
              <option [ngValue]="1">Số điện thoại</option>
              <option [ngValue]="2">Số tài khoản</option>
              <option [ngValue]="3">URL</option>
            </select>
          </div>

          <div class="form-group">
            <label for="single_info">
              <ng-container *ngIf="singleReportItem.type === 1">Số điện thoại muốn tố cáo:</ng-container>
              <ng-container *ngIf="singleReportItem.type === 2">Số tài khoản muốn tố cáo:</ng-container>
              <ng-container *ngIf="singleReportItem.type === 3">URL muốn tố cáo:</ng-container>
            </label>
            <input
              id="single_info"
              type="text"
              name="single_info"
              placeholder="Nhập thông tin nghi ngờ"
              required
              [(ngModel)]="singleReportItem.info"
              #singleInfoCtrl="ngModel"
            />
          </div>

          <div class="form-group" *ngIf="singleReportItem.type === 2">
            <label for="single_accountHolderName">Tên chủ tài khoản:</label>
            <input id="single_accountHolderName" name="single_accountHolderName" type="text" [(ngModel)]="singleReportItem.info2" />

            <label for="single_bankName">Ngân hàng:</label>
            <input id="single_bankName" name="single_bankName" type="text" [(ngModel)]="singleReportItem.info3" />
          </div>

          <div class="form-group">
            <label for="single_email">Email người báo cáo</label>
            <input
              id="single_email"
              type="email"
              name="single_emailAuthorReport"
              placeholder="Nhập email"
              required
              [(ngModel)]="singleReportItem.emailAuthorReport"
            />
          </div>

          <div class="form-group">
            <label for="single_description">Mô tả chi tiết:</label>
            <textarea
              id="single_description"
              name="single_description" rows="5"
              required
              placeholder="Mô tả chi tiết về vụ việc"
              [(ngModel)]="singleReportItem.description" ></textarea>
          </div>

          <div class="form-group">
            <label for="single_files">Tài liệu đính kèm (PNG, JPG, GIF):</label>
            <div class="drop-zone"
                (click)="fileInputSingle.click()"
                (dragover)="onDragOverSingle($event)"
                (dragleave)="onDragLeaveSingle($event)"
                (drop)="onDropSingle($event)">
              <div class="drop-zone-content">
                <div class="file-icons">
                  <i class="fas fa-file-image text-danger file-icon-fa"></i>
                  <i class="fas fa-file-image text-primary file-icon-fa"></i>
                  <i class="far fa-file-image text-success file-icon-fa"></i>
                </div>
                <p>Kéo hoặc click vào đây để upload</p>
                <input #fileInputSingle id="single_files" type="file" accept="image/*" multiple (change)="onFileSelectSingle($event)" style="display: none;" />
              </div>
            </div>
            <div class="uploaded-bill-note">
              <i class="fas fa-upload"></i> Upload bằng chứng & ảnh đoạn tin nhắn lừa đảo.
            </div>
          </div>

          <div class="form-group" *ngIf="singleReportItem.selectedFiles.length">
            <label>Các tệp đã chọn:</label>
            <ul>
              <li *ngFor="let f of singleReportItem.selectedFiles">{{ f.name }} ({{ f.size | number }} bytes) <i class="fas fa-times-circle remove-file-icon" (click)="removeFile(f, 'single')"></i></li>
            </ul>
          </div>
        </ng-container>

        <ng-container *ngIf="reportType === 'group'">
          <div *ngFor="let item of groupReportItems; let i = index" class="group-report-item">
            <div class="item-header">
              <h4>Thông tin tố cáo #{{ i + 1 }}</h4>
              <button *ngIf="groupReportItems.length > 1" type="button" class="btn btn-sm btn-danger remove-item-btn" (click)="removeGroupReportItem(i)">
                Xóa
              </button>
            </div>

            <div class="form-group">
              <label [for]="'group_type_' + i">Tố cáo về:</label>
              <select [id]="'group_type_' + i" [name]="'group_type_' + i" required [(ngModel)]="item.type" (change)="resetGroupInfoFields(i)">
                <option [ngValue]="1">Số điện thoại</option>
                <option [ngValue]="2">Số tài khoản</option>
                <option [ngValue]="3">URL</option>
              </select>
            </div>

            <div class="form-group">
              <label [for]="'group_info_' + i">
                <ng-container *ngIf="item.type === 1">Số điện thoại muốn tố cáo:</ng-container>
                <ng-container *ngIf="item.type === 2">Số tài khoản muốn tố cáo:</ng-container>
                <ng-container *ngIf="item.type === 3">URL muốn tố cáo:</ng-container>
              </label>
              <input
                [id]="'group_info_' + i"
                type="text"
                [name]="'group_info_' + i"
                placeholder="Nhập thông tin nghi ngờ"
                required
                [(ngModel)]="item.info"
              />
            </div>

            <div class="form-group" *ngIf="item.type === 2">
              <label [for]="'group_accountHolderName_' + i">Tên chủ tài khoản:</label>
              <input [id]="'group_accountHolderName_' + i" [name]="'group_accountHolderName_' + i" type="text" [(ngModel)]="item.info2"
              placeholder="Nhập tên chủ tài khoản"
              />

              <label [for]="'group_bankName_' + i">Ngân hàng:</label>
              <input [id]="'group_bankName_' + i" [name]="'group_bankName_' + i" type="text" [(ngModel)]="item.info3"
              placeholder="Nhập tên ngân hàng"
              />
            </div>

            <div class="form-group">
              <label [for]="'group_item_description_' + i">Mô tả chi tiết cho mục này:</label>
              <textarea
                [id]="'group_item_description_' + i"
                [name]="'group_item_description_' + i" rows="3"
                required
                placeholder="Mô tả chi tiết về mục tố cáo này"
                [(ngModel)]="item.description"
              ></textarea>
            </div>

          </div>
          <button type="button" class="btn btn-primary add-item-btn" (click)="addGroupReportItem()">
            <i class="fas fa-plus"></i> Thêm thông tin tố cáo khác
          </button>

            <div class="form-group">
                <label for="group_scamAmount">Số tiền lừa đảo (VND):</label>
                <div class="input-with-icon">
                  <input id="group_scamAmount" type="number" name="group_scamAmount" placeholder="Ví dụ: 1000000" [(ngModel)]="scamAmountGroup">
                  <span class="currency-unit">VND</span>
                </div>
            </div>

            <div class="form-group">
                <label for="group_description">Mô tả chi tiết:</label>
                <textarea
                  id="group_description"
                  name="group_description" rows="5"
                  required
                  placeholder="Mô tả chi tiết về vụ việc"
                  [(ngModel)]="descriptionGroup" ></textarea>
            </div>

            <div class="form-group">
                <label for="group_email">Email người báo cáo</label>
                <input
                  id="group_email"
                  type="email"
                  name="group_emailAuthorReport"
                  placeholder="Nhập email"
                  required
                  [(ngModel)]="emailAuthorReportGroup"
                />
            </div>

            <div class="form-group">
              <label for="group_common_files">Tài liệu đính kèm (PNG, JPG, GIF):</label>
              <div class="drop-zone"
                  (click)="commonGroupFileInput.click()"
                  (dragover)="onDragOverCommonGroup($event)"
                  (dragleave)="onDragLeaveCommonGroup($event)"
                  (drop)="onDropCommonGroup($event)">
                <div class="drop-zone-content">
                  <div class="file-icons">
                    <i class="fas fa-file-image text-danger file-icon-fa"></i>
                    <i class="fas fa-file-image text-primary file-icon-fa"></i>
                    <i class="far fa-file-image text-success file-icon-fa"></i>
                  </div>
                  <p>Kéo hoặc click vào đây để upload</p>
                  <input #commonGroupFileInput type="file" id="group_common_files" accept="image/*" multiple (change)="onFileSelectCommonGroup($event)" style="display: none;" />
                </div>
              </div>
              <div class="uploaded-bill-note">
                <i class="fas fa-upload"></i> Upload bằng chứng & ảnh đoạn tin nhắn lừa đảo.
              </div>
            </div>

            <div class="form-group" *ngIf="selectedFilesGroup.length">
              <label>Các tệp đã chọn:</label>
              <ul>
                <li *ngFor="let f of selectedFilesGroup">{{ f.name }} ({{ f.size | number }} bytes) <i class="fas fa-times-circle remove-file-icon" (click)="removeFile(f, 'group')"></i></li>
              </ul>
            </div>

        </ng-container>

        <div class="info-section-bottom">
          <p class="highlight-text">
            CHÚ Ý: Điều 156 Bộ luật Hình sự 2015: Tội vu khống là bịa đặt hoặc lan truyền thông tin sai sự thật xúc phạm danh dự, hoặc tố cáo sai người khác phạm tội. Hình phạt gồm phạt tiền từ 10-50 triệu đồng và/hoặc phạt tù từ 3 tháng đến 7 năm, tùy mức độ vi phạm.
          </p>
        </div>

        <div class="form-group">
          <re-captcha siteKey="6LfG6TArAAAAAD3M_YLwgUHuC6QPL7I7ATnWE4Xl" (resolved)="handleCaptchaResponse($event)"></re-captcha>
        </div>

        <div class="form-group checkbox-group">
          <input type="checkbox" id="agreeTerms" name="agreeTerms" [(ngModel)]="agreeTerms" required>
          <label for="agreeTerms">Tôi đồng ý với các <a href="#" (click)="openTermsAndConditions($event)">điều khoản và điều kiện</a></label>
        </div>

        <button class="submit-button" type="submit" [disabled]="reportForm.invalid || !captchaToken || !agreeTerms">
          Gửi Báo Cáo
        </button>
      </form>
    </div>

    <div class="right-column">
      <div class="info-box">
        <div class="info-section">
          <h4 class="section-title"><i class="info-icon warning">!</i> Chú ý</h4>
          <p>Thông Báo về Việc Báo Cáo các Trang Web Cá Độ, Cờ Bạc, 18+,...</p>
          <p>Theo đánh giá và thống kê từ cộng đồng, các trang web có nội dung 18+, cá độ bóng đá, cờ bạc trực tuyến đều vi phạm pháp luật Việt Nam với mức độ 100%.</p>
          <p class="highlight-text"><i class="info-icon warning">!</i> Vì vậy, bạn <strong>KHÔNG CẦN</strong> phải gửi báo cáo các trang web dạng này lên hệ thống của chúng tôi.</p>
          <p>Chúng tôi luôn trân trọng đóng góp quý báu từ cộng đồng. Việc không cần báo cáo những trang vi phạm pháp luật rõ ràng giúp chúng tôi tập trung nguồn lực vào việc xử lý các trang web lừa đảo tinh vi và gây hại đến người dùng.</p>
        </div>

        <div class="info-section">
          <h4 class="section-title"><i class="info-icon info">i</i> Thông tin quan trọng</h4>
          <p>Trước khi báo cáo, vui lòng kiểm tra thông tin trên hệ thống của chúng tôi. Nếu không có, hãy theo các bước để báo cáo. CheckScam sẽ xét duyệt kỹ lưỡng và quyết định cuối cùng.</p>
          <p>Ngoài ra bạn có thể tham khảo thông tin hữu ích khác:</p>
          <ul class="reference-links">
            <li><a href="https://chongluadao.vn/" target="_blank">Chống lừa đảo</a> <i class="link-icon">↗</i></li>
            <li><a href="https://tinnhiemmang.vn/" target="_blank">Tín nhiệm mạng</a> <i class="link-icon">↗</i></li>
          </ul>
        </div>
      </div>
    </div>

  </div>
</div>

<app-chat-box *ngIf="showChatbox" (close)="closeChatbox()"></app-chat-box>
<app-footer></app-footer>